<html>
<head>
<script type="text/javascript">
WB_wombat_Init("https:///web", "20101219093204", "pyrorobotics.org");
</script>
 <link rel="stylesheet" href="../stylesheet.css">
<title>Pyro, Python Robotics: Using_20the_20Hemisson_20Robot</title> <meta http-equiv="Content-Type" content="text/html;">
</head>
<body bgcolor="#ffffff">
<table border="0" cellpadding="0" cellspacing="0">
  <tr>
   <td width="804" colspan="8" align="center"><img src="../images/PyroLogo.gif" width="800" height="100"></td>
  </tr>
  <tr>
<td>[&nbsp;<a href="../page_Pyro/">Home</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroSoftware/">Software</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroCurriculum/">Curriculum</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroHardware/">Hardware</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroCommunity/">Community</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroWhatsNew/">News</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroPublications/">Publications</a>&nbsp;]</td><td>[&nbsp;<a href="../page_FindPage/">Search</a>&nbsp;]</td>  </tr>
</table>
<table width="804" border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="8">
<p><hr><p>
<p>
<h1 width="804">1.  Setting up Linux for use with the Hemisson Robot</h1>
<p>
The <a href="http://www.k-team.com/kteam/index.php?site=1&amp;rub=22&amp;page=16&amp;version=EN"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;Hemisson</a> is a small, inexpensive robot from <a href="http://www.k-team.com/kteam/home.php?rub=0&amp;site=1&amp;version=EN"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;K-Team</a> based on their Khepera robot. It has an excellent set of features for the price. In addition, it has a wireless Bluetooth interface, which makes it work very well untethered with <a href="../page_Pyro/">Pyro</a>. This page details getting the radio Hemisson working under Fedora Core 2.
 <img width="11" src="../wiki/img/idea.png"> Pyro, versions 3.1.0 and higher now work with the Hemisson thanks to Robin Knight and Kim Wheeler from <a href="http://www.roadnarrowsrobotics.com/"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;RoadNarrows</a>.
<p>
<p>
<h2 width="804">1.1.  Hemisson Software Update</h2>
<p>
To run the Hemisson under Linux, you will need to update your Hemisson on-board program. This section details the steps involved. These instructions provided by the kind folks at <a href="http://www.roadnarrowsrobotics.com/"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;RoadNarrows</a>. A Users Guide can be found <a href="http://emergent.brynmawr.edu/~dblank/pyrobot/tars/hemisson/"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;here</a>.
<p>
<ol type="1"><li>Make sure the Bluetooth module is removed from the Hemisson.</li>
<li>Attach a serial cable between a Windows PC and the Hemisson.</li>
<li>Make sure the download tool <a href="http://www.k-team.com/kteam/index.php?site=1&amp;rub=4&amp;page=175&amp;version=EN"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;Hemisson Uploader</a> is installed on the Windows PC.</li>
<li>Download the updated Hemisson control program from <a href="http://emergent.brynmawr.edu/~dblank/pyrobot/tars/hemisson/"><img border="0" width="11" src="../wiki/img/moin-png">&nbsp;here</a>.</li>
<li>Set the Hemisson to PGM mode (left front switch) and turn on the Hemisson. Along with the power LED, you should also see the red PGM LED lit.</li>
<li>Run the Hemisson Uploader.</li>
<li>Press the &quot;Search&quot; button and choose the <tt class="wiki">hemiosXXXX.hex</tt> file (where <i>XXXX</i> is the highest number/letter combination).</li>
<li>Press the &quot;Write&quot; button. The &quot;Info&quot; status field goes through various messages and at a successful download, ends with the message &quot;All OK!&quot;</li>
<li>Turn off the Hemisson and set it back to Exec mode.</li>
<li>Attach the Bluetooth module.</li>
<li>Turn on the Hemisson. You should be already to go.</li>
 <img width="11" src="../wiki/img/idea.png"> This <a href="../page_HemiOS/">HemiOS</a> does not contain any of the builtin dancing, line-following, or Braitenberg modes. 
</ol><p>
<p>
<h2 width="804">1.2.  Linux Bluetooth Installation</h2>
<p>
Most of these instructions should apply to any modern Linux running a 2.6 kernel.
<p>
You'll need to get the bluez support tools and libraries. We did that as root, with:
<p>
<pre class="code">
# <b>yum search bluez</b>
</pre>
<p>
which told us about the following packages:
<p>
<pre class="code">
# <b>yum search bluez</b>
Gathering header information file(s) from server(s)
Server: hokie.brynmawr.edu Fedora Core 2 - i386 - Base
Server: hokie.brynmawr.edu Fedora Core 2 - i386 - Released Updates
Finding updated packages
Downloading needed headers
Looking in available packages for a providing package
Available package: bluez-libs-devel.i386 0:2.5-2.1 from base matches with
 bluez-libs-devel
Available package: bluez-sdp-devel.i386 0:1.5-2.1 from base matches with
 bluez-sdp-devel
2 results returned
Looking in installed packages for a providing package
Installed package: bluez-bluefw.i386 0:1.0-2 matches with
 bluez-bluefw
Installed package: bluez-sdp.i386 0:1.5-2.1 matches with
 bluez-sdp
Installed package: bluez-hcidump.i386 0:1.5-4 matches with
 bluez-hcidump
Installed package: bluez-pin.i386 0:0.23-1 matches with
 bluez-pin
Installed package: bluez-utils.i386 0:2.4-3 matches with
 bluez-utils
Installed package: bluez-pan.i386 0:1.1-4 matches with
 bluez-pan
Installed package: bluez-libs.i386 0:2.5-2.1 matches with
 bluez-libs
7 results returned
</pre>
<p>
On Fedora Core 3 and 4, this is installed by default. If you need to install them manuall, we installed these packages:
<p>
<pre class="code">
# <b>yum -y install bluez-bluefw bluez-sdp  bluez-hcidump  bluez-pin  bluez-utils  bluez-pan</b>
</pre>
<p>
Now we are ready to see if Linux can see the Hemisson. Put the Hemisson into serial port mode (Pgm/Exec in Exec, On/Off in On, and all of the switches to the left when the battery is on the far side away from you. See the Hemisson manual for more details.)
<p>
You should see something like the following when you enter <b>hciconfig</b>:
<p>
<pre class="code">
# <b>hciconfig</b>
hci0:   Type: USB
        BD Address: 00:0C:76:AB:4B:8E ACL MTU: 192:8  SCO MTU: 64:8
        DOWN
        RX bytes:45605 acl:91 sco:0 events:6293 errors:0
        TX bytes:90141 acl:6264 sco:0 commands:24 errors:0
</pre>
<p>
This indicates that we can see the Bluetooth USB dongle. Now, we need to bring <i>up</i> this device (like one does with a ethernet network connection). But first, we need to make a few changes to <tt class="wiki">/etc/bluetooth/hcid.conf</tt> in the <i>options</i> section. You need to change security from <b>auto</b> to <b>none</b>, and change pairing from <b>multi</b> to <b>none</b>. Also, comment out <i>pin_helper</i>.
<p>
While we are here, go ahead and add in the <b>device</b> section, the option <b>lm slave,accept;</b> and comment out the other <b>lm</b> lines, <b>auth enable;</b>, and <b>encrypt enable;</b>. Here is a copy of our <tt class="wiki">/etc/bluetooth/hcid.conf</tt> file:
<p>
<pre class="code">
#
# HCI daemon configuration file.
#
# &#36;Id: hcid.conf,v 1.3 2002/07/18 18:12:46 maxk Exp &#36;
#
# HCId options
options {
        # Automatically initialize new devices
        autoinit yes;
        # Security Manager mode
        #   none - Security manager disabled
        #   auto - Use local PIN for incoming connections
        #   user - Always ask user for a PIN
        #
        security none; # was auto
        # Pairing mode
        #   none  - Pairing disabled
        #   multi - Allow pairing with already paired devices
        #   once  - Pair once and deny successive attempts
        pairing none; # was multi
        # PIN helper
        #pin_helper /usr/bin/bluepin;
        #dbus_pin_helper;
        # A dbus PIN daemon can be found at
        # ftp://ftp.handhelds.org/pub/projects/gpe/source/bluez-pin-0.20.tar.gz
}
# Default settings for HCI devices
device {
        # Local device name
        #   %d - device id
        #   %h - host name
        name &quot;%h-%d&quot;;
        # Local device class
        class 0x120104;
        # Default packet type
        #pkt_type DH1,DM1,HV1;
        pkt_type DM1,DM3,DM5,DH1,DH3,DH5,HV1,HV2,HV3;
        # Inquiry and Page scan
        iscan enable; pscan enable;
        # Default link mode
        #   none   - no specific policy
        #   accept - always accept incoming connections
        #   master - become master on incoming connections,
        #            deny role switch on outgoing connections
        #
        #lm accept,master;
        #
        #lm accept;
        lm slave,accept;
        # Default link policy
        #   none    - no specific policy
        #   rswitch - allow role switch
        #   hold    - allow hold mode
        #   sniff   - allow sniff mode
        #   park    - allow park mode
        #
        #lp hold,sniff;
        #
        lp hold,sniff,park;
        # Authentication and Encryption
        #auth enable;
        #encrypt enable;
}
</pre>
<p>
On Fedora Core 3 and 4, the following demons were already running. If they aren't you need to start them. You won't have to do this after a reboot, in any case.
<p>
<pre class="code">
# <b>hcid</b>
# <b>sdpd</b>
</pre>
<p>
Now, we should be able to bring the hci USB device up:
<p>
<pre class="code">
# <b>hciconfig hci0 up</b>
</pre>
<p>
And checking to see that it is indeed up:
<p>
<pre class="code">
# <b>hciconfig</b>
hci0:   Type: USB
        BD Address: 00:0C:76:AB:4B:8E ACL MTU: 192:8  SCO MTU: 64:8
        UP RUNNING PSCAN ISCAN
        RX bytes:45894 acl:91 sco:0 events:6298 errors:0
        TX bytes:90162 acl:6264 sco:0 commands:26 errors:0
</pre>
<p>
There are many tools available to test out the connection. You can:
<p>
<pre class="code">
# <b>hcitool scan</b>
Scanning ...
        00:04:3E:C1:56:93       hemradio93
</pre>
<p>
There it is! If you have multiple Hemissons turned on with the radio link kit, you would see them there too. We are almost ready to talk to the robot. 
<p>
Next, we will edit <tt class="wiki">/etc/bluetooth/rfcomm.conf</tt> by putting some of the information from the scan. You need to change the device address, and you may want to change the name, like so:
<p>
<pre class="code">
#
# RFCOMM configuration file.
#
# &#36;Id: rfcomm.conf,v 1.1 2002/10/07 05:58:18 maxk Exp &#36;
#
#
# Example:
#
rfcomm0 {
        # Automatically bind the device at startup
        bind yes;
        # Bluetooth address of the device
        #device 11:22:33:44:55:66;
        device 00:04:3E:C1:56:93; # hemisson
        # RFCOMM channel for the connection
        channel 1;
        # Description of the connection
        comment &quot;Hemisson Bluetooth device&quot;;
}
</pre>
<p>
Finally, you need to bind the TTY ports with:
<p>
<pre class="code">
# rfcomm bind all
</pre>
<p>
You should now be able to open <tt class="wiki">/dev/rfcomm0</tt> or <tt class="wiki">/dev/ttyUB0</tt> as a serial connection and talk to your Hemisson as if it were directly connected via a serial cable.
<p>
You'll notice the green connect light is on, and the green RX light is flashing on the Hemisson when it is receiving commands.
<p>
<p>
<h2 width="804">1.3.  Multiple Hemissons</h2>
<p>
For each Hemisson that you have, you will need the scan information, and a section in the <tt class="wiki">rfcomm.conf</tt> file. For example, the second Hemisson might give:
<p>
<pre class="code">
# <b>hcitool scan</b>
Scanning ...
        00:04:3E:C1:56:93       hemradio93
        00:04:3E:C1:56:95       hemradio95
</pre>
<p>
and so you would add:
<p>
<pre class="code">
rfcomm1 {
        bind yes;
        device 00:04:3E:C1:56:95;
        channel 1;
        comment &quot;Hemisson Bluetooth device #2&quot;;
}
</pre>
<p>
to the bottom of the rfcomm.conf file. That's it!
<p>
Next: <a href="../page_Using_20the_20Sony_20AIBO_20Robot/">Using the Sony AIBO Robot</a>
Up: <a href="../page_PyroHardware/">PyroHardware</a>
<p><hr align="left" width="804"></td></tr>
</table><table width="804" border="0" cellpadding="0" cellspacing="0"><tr><td>[&nbsp;<a href="../page_Pyro/">Home</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroSoftware/">Software</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroCurriculum/">Curriculum</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroHardware/">Hardware</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroCommunity/">Community</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroWhatsNew/">News</a>&nbsp;]</td><td>[&nbsp;<a href="../page_PyroPublications/">Publications</a>&nbsp;]</td><td>[&nbsp;<a href="../page_FindPage/">Search</a>&nbsp;]</td></tr>
<tr><td colspan="8">
<br>
    <a href="http://creativecommons.org/licenses/by-sa/2.0/">
       <img alt="CreativeCommons" border="0" src="../html/somerights.gif">
    </a>
<a href="http://emergent.brynmawr.edu/index.cgi/Using_20the_20Hemisson_20Robot?action=show">View Wiki Source</a> | <a href="http://emergent.brynmawr.edu/index.cgi/Using_20the_20Hemisson_20Robot?action=edit">Edit Wiki Source</a> | <a href="mailto:dblank@cs.brynmawr.edu">Mail Webmaster</a></td></tr>
</table>
</body>
</html>